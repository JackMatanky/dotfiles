#!/usr/bin/env bash
{{/* vim: set filetype=bash: */}}
{{- if .packages.cargo.crates }}
# -----------------------------------------------------------------------------
# Script: run_once_after_71-upgrade-cargo-packages.sh.tmpl
# Purpose: Initial Rust toolchain update and Cargo package setup (runs once)
# When: Runs once after Cargo packages are installed
# Dependencies: Rust, Cargo, cargo-update
# Note: For regular updates, use: cargo install-update --all
# -----------------------------------------------------------------------------

set -euo pipefail

{{ template "logging.sh" . }}

log_header "ðŸ”„ CARGO PACKAGE UPGRADES"

# Ensure cargo is available
if ! command -v cargo &> /dev/null; then
    log_warning "Cargo not available. Skipping Cargo package upgrades."
    exit 0
fi

# Update Rust toolchain
log_info "Updating Rust toolchain..."
rustup update

# Update all installed packages if cargo-update is available
if command -v cargo-install-update &> /dev/null; then
    log_info "ðŸ”„ Updating all installed Cargo packages..."
    if cargo install-update --all; then
        log_success "All Cargo packages updated"
    else
        log_warning "Some Cargo packages failed to update"
    fi
else
    log_info "cargo-update not available, install with: cargo install cargo-update"
fi

log_success "âœ… Cargo package upgrades completed!"
{{- else }}
#!/usr/bin/env bash
# Cargo packages list is empty - skipping Cargo package upgrades
exit 0
{{- end }}
