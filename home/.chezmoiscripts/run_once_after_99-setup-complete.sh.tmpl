#!/usr/bin/env bash
{{/* vim: set filetype=bash: */}}
# -----------------------------------------------------------------------------
# Script: run_once_after_99-setup-complete.sh.tmpl
# Purpose: Mark initial setup as complete and provide summary (runs once)
# When: Runs once after all package installation scripts complete
# Dependencies: All other setup scripts
# -----------------------------------------------------------------------------

set -euo pipefail

{{ template "logging.sh" . }}

log_header "âœ… CHEZMOI INITIAL SETUP COMPLETE"

# Create marker file to indicate initial setup is complete
# This prevents upgrade scripts from running automatic updates on existing systems
mkdir -p "$HOME/.config"
touch "$HOME/.config/chezmoi-initial-setup-complete"

log_success "Dotfiles configuration applied successfully!"
log_info ""
log_info "ðŸ”§ What was configured:"
{{- if eq .chezmoi.os "darwin" }}
log_info "  â€¢ Homebrew package manager and {{ len .packages.darwin.brews }} CLI tools"
log_info "  â€¢ {{ len .packages.darwin.casks }} GUI applications via Homebrew casks"
{{- if .packages.darwin.mas }}
log_info "  â€¢ {{ len .packages.darwin.mas }} Mac App Store applications"
{{- end }}
{{- else if eq .chezmoi.os "linux" }}
{{- if .packages.linux.flatpak }}
log_info "  â€¢ {{ len .packages.linux.flatpak }} Flatpak applications"
{{- end }}
{{- if .packages.linux.apt }}
log_info "  â€¢ {{ len .packages.linux.apt }} APT packages"
{{- end }}
{{- if .packages.linux.snap }}
log_info "  â€¢ {{ len .packages.linux.snap }} Snap packages"
{{- end }}
{{- end }}
{{- if .packages.cargo.crates }}
log_info "  â€¢ {{ len .packages.cargo.crates }} Rust/Cargo packages"
{{- end }}
log_info "  â€¢ Shell environment (Zsh with Starship prompt)"
log_info "  â€¢ Development tools and configuration"
log_info ""
log_info "ðŸ“‹ Next steps:"
log_info "  â€¢ Restart your shell: exec \$SHELL"
log_info "  â€¢ For package updates, use manual commands or justfile tasks"
log_info "  â€¢ Configuration changes will be applied with: chezmoi apply"

log_success "ðŸŽ‰ Welcome to your new development environment!"
