#!/usr/bin/env bash
# vim: filetype=bash

# -----------------------------------------------------------------------------
# Script: run_once_before_10-homebrew-setup.sh.tmpl
# Purpose: Install and setup Homebrew (runs once before other package scripts)
# Dependencies: macOS
# -----------------------------------------------------------------------------

{{- if eq .chezmoi.os "darwin" }}

set -euo pipefail

{{ template "logging.sh" . }}

# Check if running on macOS
if [[ "$(uname -s)" != "Darwin" ]]; then
    log_error "This script is designed for macOS only"
    exit 1
fi

log_header "ðŸº HOMEBREW SETUP"

# Install Homebrew if not present
if ! command -v brew &> /dev/null; then
    log_info "Installing Homebrew..."
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

    # Add Homebrew to PATH for Apple Silicon Macs
    if [[ -f "/opt/homebrew/bin/brew" ]]; then
        echo 'eval "$(/opt/homebrew/bin/brew shellenv)"' >> ~/.zprofile
        eval "$(/opt/homebrew/bin/brew shellenv)"
    fi

    log_success "Homebrew installed successfully"
else
    log_success "Homebrew already installed"
fi

# Update Homebrew
log_info "Updating Homebrew..."
brew update

log_success "âœ… Homebrew setup completed!"
{{- end }}
