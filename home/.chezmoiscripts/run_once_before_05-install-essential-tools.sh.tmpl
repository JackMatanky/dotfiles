#!/usr/bin/env bash
# Install essential CLI tools (depends on Homebrew being already installed)
set -euo pipefail

{{ template "logging.sh" . }}

# Skip if existing system
[[ -f "$HOME/.config/chezmoi-initial-setup-complete" ]] && exit 0

# Ensure Homebrew is available
if ! command -v brew &>/dev/null; then
    log_error "Homebrew not found - run Homebrew installation script first"
    exit 1
fi

# Check if any essential tools are actually missing
# Most systems come with curl, git, and basic utilities pre-installed
# Only install tools if they're genuinely missing and required for setup scripts

MISSING_ESSENTIALS=()

# curl is required for Homebrew installation (but usually pre-installed)
if ! command -v curl &>/dev/null; then
    MISSING_ESSENTIALS+=("curl")
fi

# git might be needed for some package installations (but usually pre-installed)
if ! command -v git &>/dev/null; then
    MISSING_ESSENTIALS+=("git")
fi

if [[ ${#MISSING_ESSENTIALS[@]} -eq 0 ]]; then
    log_info "All essential tools already available, skipping installation"
else
    log_info "Installing missing essential tools: ${MISSING_ESSENTIALS[*]}"
    for tool in "${MISSING_ESSENTIALS[@]}"; do
        log_info "Installing $tool..."
        brew install "$tool"
    done
    log_success "Essential CLI tools installed"
fi
